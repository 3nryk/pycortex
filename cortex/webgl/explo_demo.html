{% autoescape None %}
{% extends demo.html %}
{% block jsinit %}
    var viewer, subjects, datasets, figure, sock, viewopts;
{% end %}
{% block extrahtml %}
	<div id="display_cover">
  	<div id="swipe_right" class="swipe_helper">
  		<img src="resources/explo_demo/swipe_right.svg" /> 
  		Twirl left for intro
  	</div>
  	<div id="swipe_left" class="swipe_helper">
  		<img src="resources/explo_demo/swipe_left.svg" /> 
  		Twirl right <span id="swipe_left_text">to continue</span>
  	</div>
    <div id="gestures">
      <p>Explore the brain activity of someone watching this video</p>
      <img id="gesture_1" />
      <img id="gesture_2" />
      <p id="gesture_name">Rotate</p>
    </div>
    <div id="intro_frame">
    </div>
  </div>
  <div id="attribution">
    <p> pycortex software by James Gao</p>
    <p> Introduction by Natalia Bilenko</p>
    <p> Instruction graphics by Helene Moorman</p>
    <p> Decoding by Natalia Bilenko, Valkyrie Savage, and Shinji Nishimoto</p>
    <p> Localizer data by Mark Lescroart</p>
    <p>Funding support from NEI-EY019684 and NSF-0939370 grant awards to Jack Gallant, University of California at Berkeley. </p>
  </div>

<script type="text/javascript">
var intro_frame = 0;
$("#intro_frame").load("resources/explo_demo/intro.svg");
var explain_fade = function(frame) {
  for (var i = 0; i < 5; i++) {
    $("#explanation_"+i).css("opacity", frame==i);
  }
  $("#explanation_"+frame).fadeOut();
}
var explain_dots = function(frame) {
  $("#explanation_"+frame).fadeIn();
  for (var i = 0; i < 5; i++) {
    $("#framedot_"+i).css("fill", frame == i ? "steelblue" : "gray");
  }
}

function nextFrame() {
  if (intro_frame == 0) {
    intro_frame = 1;
    explain_fade(0);
    $("#human_brain").fadeOut();
    $("#dots").fadeOut(400, function() {
        explain_dots(1);
      $("#model").fadeIn();
      $("#dots").fadeIn();
    });
  } else if (intro_frame == 1) {
    intro_frame = 2;
    explain_fade(1);
    $("#enc_arrows").fadeOut();
    $("#presented_movie").fadeOut();
    $("#fmri_responses").fadeOut();
    $("#dots").fadeOut(400, function() {
      $("#model").animate({svgTransform:"translate(0,270)"}, 800, function() {
        explain_dots(2);
        $("#dots").fadeIn();
      });
    });
  } else if (intro_frame == 2) {
    intro_frame = 3;
    explain_fade(2);
    $("#dots").fadeOut(400, function() {
      explain_dots(3);
      $("#new_movie").fadeIn();
      $("#human_brain").fadeIn();
      $("#new_responses").fadeIn();
      $("#enc_arrows").fadeIn();
      $("#dots").fadeIn();
    });
  } else if (intro_frame == 3) {
    intro_frame = 4;
    explain_fade(3);
    $("#dots").fadeOut(400, function() {
      explain_dots(4);
      $("#dots").fadeIn();
      $("#dec_arrows").fadeIn();
      $("#decoded_movie").fadeIn();
    });
  } else if (intro_frame == 4) {
    intro_frame = 0;
    $("#model").fadeOut().animate({svgTransform:"translate(0,0)"});
    $("#enc_arrows").fadeOut();
    $("#dec_arrows").fadeOut();
    $("#decoded_movie").fadeOut();
    $("#new_movie").fadeOut();
    $("#new_responses").fadeOut();
    $("#human_brain").fadeOut();
    explain_fade(4);
    $("#explanation_4").fadeOut();
    $("#dots").fadeOut(400, function() {
      $("#fmri_responses").fadeIn();
      $("#human_brain").fadeIn();
      explain_dots(0);
      $("#dots").fadeIn();
      $("#enc_arrows").fadeIn();
      $("#presented_movie").fadeIn();
    })
  }
};
</script>

{% end %}
{% block onload %}
		viewopts = {
			voxlines: {{voxlines}},
			voxline_width: {{voxline_width}},
			default_2Dcmap: "RdBu_covar",
		};
		
	    subjects = {{subjects}};
		for (var name in subjects) {
			subjects[name] = new mriview.Surface(subjects[name]);
		}

		figure = new jsplot.W2Figure();
		viewer = figure.add(mriview.Viewer, "main", true);

		dataviews = dataset.fromJSON({{data}});
		viewer.addData(dataviews);

{% end %}