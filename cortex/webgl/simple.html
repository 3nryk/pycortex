<!doctype html>
<html>
<title>Brain</title>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<link rel="stylesheet" href="resources/css/ui-lightness/jquery-ui-1.8.21.custom-2.css" type='text/css' />
<link rel="stylesheet" href="resources/css/jquery.miniColors.css" type='text/css' />

<script type='text/javascript' src='resources/js/jquery-1.8.0.min.js'></script>
<script type='text/javascript' src='resources/js/jquery-ui-1.8.23.custom.min.js'></script>
<script type='text/javascript' src='resources/js/jquery.ddslick.min.js'></script>
<script type='text/javascript' src='resources/js/jquery.miniColors.js'></script>

<script type='text/javascript' src="resources/js/Three.js"></script>
<script type='text/javascript' src="resources/js/ctm/lzma.js"></script>
<script type='text/javascript' src="resources/js/ctm/ctm.js"></script>
<script type='text/javascript' src="resources/js/ctm/CTMLoader.js"></script>

<script type="text/javascript" src="resources/js/rgbcolor.js"></script> 
<script type="text/javascript" src="resources/js/canvg.js"></script> 

<script type='text/javascript' src='resources/js/datamodel.js'></script>
<script type='text/javascript' src='resources/js/svgroi.js'></script>
<script type='text/javascript' src='resources/js/shadowtex.js'></script>
<script type='text/javascript' src='resources/js/facepick.js'></script>
<script type='text/javascript' src="resources/js/LandscapeControls.js"></script>
<script type='text/javascript' src='resources/js/mriview.js'></script>
{% if python_interface %}
<script type='text/javascript' src='resources/js/python_interface.js'></script>
{% end %}
{% block javascripts %}
{% end %}

<link rel="stylesheet" href="resources/css/mriview.css" type='text/css' />
<style type='text/css'>
	ul#datasets li .handle {
		display:none;
	}
	fieldset > legend {
		font-weight: bold;
	}
	#helpmenu {
		position:absolute;
	    background:rgba(0, 0, 0, 0.6);
	    transition:opacity 0.25s;
	    -moz-transition:opacity 0.25s;
	    -webkit-transition:opacity 0.25s;
	    padding:0.5em;
	    margin:2em;
	    margin-top:-20em;
	    width:15em;
	    z-index:100;
	    -moz-border-radius:10px;
		-webkit-border-radius:10px;
	    border-radius:10px;
	    color:white;
	    font-family:arial;
	    border:2px solid #ffffff;
	    /*text-shadow:0 0 3px black;*/
	}
	#intro {
		position:absolute;
		color:white;
		width:60%;
		height:50%;
		left:20%;
		top:20%;
		border-radius:10px;
		padding:2em;
		padding-left:14px;
		padding-left:10px;
		z-index:100;
		text-shadow:none;
		background-color:rgba(0,0,0,0.9);
		-moz-border-radius:10px;
		-webkit-border-radius:10px;
		border-radius:10px;
		border:2px solid #ffffff;
	}
	#introclose {
		float:left;
		background-color:black;
		margin-top:-3em;
		margin-left:-3em;
	}
	#introclose:hover {
		background-color:rgba(48,48,48,1.0);
		position:relative;
	}
	#introtext {
		overflow: scroll;
		text-align:left;
		width:100%;
		height:100%;
		font-size:16pt;
	}
	.infobar {
		background-color: rgba(0,0,0,0.8);
		border-bottom: 2px solid white;
	}
	.infobar:hover, .infobar:active {
		background-color: rgba(0,0,0,0.8);
	}
	#topbar {
		margin:-190px 0 -10px 0; 
		height:200px;
		width:auto;
		border-radius: 0 0 0 0 / 0 0 0 0;
		color:white;
	}
	#topbar:hover, #topbar:active {
		margin:0px 0 -200px 0;
	}
	#topgrab {
		color:white;
		margin-left: auto;
		margin-right: auto;
		text-align: center;
		position: absolute;
		top:100%;
		margin-top:-15px;
		width:100%;
	}
	#display_options fieldset {
	    border:1px solid #fff;
	    border-radius: 5px 5px 5px 5px / 5px 5px 5px 5px;
	}
	ul#datasets { 
		color:black;
		width:300px;
	}
	#bottombar {
		margin-top:-100px;
		z-index:10;
		position:relative;
	}
	#bottombar table {
		padding:4px;
		width:100%;
	}
	#bottombar table td {
		/*width:25% !important;*/
		padding-bottom: 10px;
	}
	#bottombar table td:first-child {
	    width:auto;
	    min-width:auto;
	}
	#bottombar:hover, #bottombar:active {
		margin-top:-100px;
	}
	div#pluginbox {
		height:100%;
		min-height:100%;
		position:relative;
	}
	button {
		background-color:rgba(0,0,0,0.6);
		-moz-border-radius:10px;
		-webkit-border-radius:10px;
		border-radius:10px;
		border:3px solid #ffffff;
		display:inline-block;
		color:#ffffff;
		font-family:arial; 
		font-size:15px;
		font-weight:bold;
		padding:6px 24px;
		text-decoration:none;
	}
	button:hover {
		background-color:rgba(80,80,80,0.6);
		position:relative;
		/*top:1px;*/
	}
	#dataname {
		text-shadow:none;
		background-color:rgba(0,0,0,0.6);
		-moz-border-radius:10px;
		-webkit-border-radius:10px;
		border-radius:10px;
		border:2px solid #ffffff;
	}
	/* This imageless css button was generated by CSSButtonGenerator.com */
</style>

<script type='text/javascript'>
	function webgl() { 
		try { 
			return !! window.WebGLRenderingContext && !! document.createElement( 'canvas' ).getContext( 'experimental-webgl' ); 
		} catch( e ) { 
			return false; 
		} 
	};
	function vtex(vtmin, atmin) {
		var gl = document.createElement("canvas").getContext('experimental-webgl');
		var vtex = gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);
		var atex = gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);
		if (vtex >= vtmin && atex >= atmin)
			return true;
		return false;
	}

	{% block jsinit %}
	{% end %}

	var cmapnames = {}

	$(document).ready(function() {
		$("#colormap option").each(function(idx) {
			cmapnames[$(this).text()] = idx;
		});

		$("#introclose").click(function() { $("div#intro").toggle() });

		window.addEventListener("keypress", function(e) {
			if (e.keyCode == 104)
				$("#helpmenu").css("opacity", $("#helpmenu").css("opacity") == 1 ? 0 : 1);
			if (e.keyCode == 105)
				$("div#intro").toggle();
		});

		if (!webgl()) {
			$(".loadmsg").hide();
			$("#ctmload").html("<p>Sorry, it seems you have no <a href='http://get.webgl.org'>WebGL support.</a> :(</p><p>If you are using Chrome, try <a href='http://peter.sh/experiments/chromium-command-line-switches/#ignore-gpu-blacklist'>ignoring the GPU blacklist.</a></p>").show();
		} else if (!vtex(4, 9)) {
			$(".loadmsg").hide();
			$("#ctmload").html("<p>Sorry, your computer does not have the minimum number of texture units :(</p><p>Try upgrading your drivers and/or your browser</p>");
		} else {
			{% block onload %}
			{% end %}
		}
	})
</script>
</head>
<body>
<div id='topbar' class='infobar'>
	<div class='content'>
		<form id='display_options'>
			<fieldset id='color_fieldset' class='opt_category'>
				<legend>Data Range</legend>
				<table>
					<tr><td class='vcolorbar'>
						<div id='vminmax2'>
							<input type='text' id='vmax2' class='vlim'/>
							<div class='vrange_wrap'><div id='vrange2'></div></div>
							<input type='text' id='vmin2' class='vlim'/>
							<div class='clear'></div>
						</div>
					</td><td>
						<select id='colormap'>
							{% for name, img in colormaps %}
							<option data-imagesrc='{{img}}' {% if name == default_cmap %}selected='selected'{%end%}>{{name}}</option>
							{% end %}
						</select>
					</td></tr>
					<tr><td class='vcolorbar'></td><td>
						<div id='vminmax'>
							<input type='text' id='vmin' class='vlim' />
							<div class='vrange_wrap'><div id='vrange'></div></div>
							<input type='text' id='vmax' class='vlim' />
							<div class='clear'></div>
						</div>
					</td></tr>
				</table>
			</fieldset>
			<div class='opt_category'>
			<fieldset id="roi_fieldset" class='subtable'>
				<legend>ROIs</legend>
				<div class='display_opt'>
					<input id='roishow' type='checkbox' checked='checked'><label for='roishow'>Show</label>
					<input id='labelshow' type='checkbox' checked='checked'><label for='labelshow'>Labels</label>
				</div>
			</fieldset>
			<fieldset id="layers_fieldset" class='subtable' style="height: 40px;">
				<legend>Data Opacity</legend>
				<div class='display_opt'>
					<table id='layerData'>
						<tr>
							<!-- <td><label for='layer_dataalpha'>Data</label></td> -->
							<td><div id='layer_dataalpha'></div></td>
						</tr>
					</table>
				</div>
			</fieldset>
			</div>
			<fieldset id="dataset_fieldset" class='opt_category'>
				<legend>Datasets</legend>
				<ul id='datasets'>
				</ul>
			</fieldset>
		</form>
	</div>
	<div id="topgrab">=</div>
</div>

<div id='intro'>
	<button id='introclose'>x</button>
	<div id='introtext'>
	<p style="font-size:18pt;text-align:center;">Welcome to the pycortex WebGL MRI viewer!</p>
	<p>
	This viewer shows how information about thousands of object and action categories are distributed across human neocortex. The data come from brain activity measurements made using fMRI while one participant watched hours of movie trailers. Computational modeling procedures were used to determine how 1705 distinct object and action categories are mapped across the cortical surface. Further details on this work can be found in Huth, Nishimoto, Vu and Gallant (2012), <a href='http://dx.doi.org/10.1016/j.neuron.2012.10.014' target='_blank'>"A continuous semantic space describes the representation of thousands of object and action categories across the human brain"</a>, <em>Neuron</em>, ##, ####. <strong>All data are copyright UC Regents and Gallant lab. WordNet is copyright the trustees of Princeton University.</strong>
	</p>
	<p><strong style="color:rgb(255,100,100)">Warning:</strong>This page uses WebGL, an experimental web technology. It will not work in all browsers or on all platforms. For the best experience we recommend using <a href='http://www.google.com/chrome'>Google Chrome</a>.</p> 
	<p><strong>Instructions:</strong>
	On the left is a 3D model of one participant's cortical surface. Use the left mouse button to rotate, right mouse button to zoom, and middle mouse button to pan. The buttons at the bottom change the way the surface is shown. When viewing the 2D flat surface, use the left mouse button to pan.<br/>
	The colors on the surface indicate which object and action categories are represented in each part of the brain. These colors match the colors of the categories on the right. <br/>
	On the right is a tree showing 1705 object and action categories. Mouse over a category to see its name and definition. Click on a category to see how it is represented across the cortical surface. To return to the original colorful view mouse over the bar at the very top of the brain viewer window, and then click "Semantic Space" (under "Datasets"). <br/>
	Back on the brain viewer, click on the brain to show which categories are represented at each location on the tree. To return the tree to the original colorful view, click on "Show Semantic Space" under the category tree.
	</p>
	<p><strong>Caveat:</strong> All of the category-specific responses shown here are based on blood-oxygen level dependent (BOLD) responses recorded while participants watched 2 hours of natural movies. BOLD was measured using fMRI, which is very noisy and which only reveals a small fraction of the information represented in the brain. Please do not try to read too much into the category responses for a single brain area.</p>
	<p><strong>Hints:</strong> The 3D viewer will run much faster if the ROI labels are disabled. To do this, mouse over the bar at the very top of the brain viewer window and uncheck the box next to "Labels". <br/>
	While the viewer is showing the inflated or flattened cortex, a double left click and hold will show the same location on the fiducial (folded) 3D surface. Releasing the mouse button will return to the folded/inflated view.</p>
	</div>
</div>

<div id='main'>
	<div id='left'>
		<div id='dataload' class='loadmsg'><img src='resources/images/loading.gif'>Loading data...</div>
		<div id='ctmload' class='loadmsg'><img src='resources/images/loading.gif'>Loading brain...</div>
		<div id='dataname'></div>
		<div id='roilabels'></div>
		<div id='braincover'></div>
		<canvas id='brain'></canvas>
	</div>
	<div id='bar'>
		<div class='vcenter'>
			=<br/>=
		</div>
	</div>
	<div id='sidepanel'>
	    <div class='vcenter'>
	    	<div id='pluginload' class='loadmsg'><img src='resources/images/loading.gif'>Loading...</div>
	    	<div id='pluginbox'>
	    	</div>
	    </div>
	</div>
</div>

<table id='helpmenu'>
	<tr><td>h</td><td>Toggle this box</td></tr>
	<tr><td>i</td><td>Toggle intro msg</td></tr>
	<tr><td>+</td><td>Next Dataset</td></tr>
	<tr><td>-</td><td>Prev Dataset</td></tr>
	<tr><td>Lft mouse</td><td>Rotate</td></tr>
	<tr><td>Mid mouse</td><td>Pan</td></tr>
	<tr><td>Rgt mouse</td><td>Zoom</td></tr>
</table>

<div id='bottombar'>
	<div class='content'>
		<div id='moviecontrols'>
			<table id='movieui'>
				<tr>
					<td><input type='text' id='movieframe' /></td>
					<td id='movieprogress'><div></div></td>
					<td id='moviecontrol'><img src='resources/images/control-play.png' /></td>
				</tr>
			</table>
		</div>
		<table>
			<tr id='mixbtns'>
			</tr>
			<tr>
				<td><div id="mix" title="Slide to control how inflated the brain is"></div></td>
			</tr>
		</table>
	</div>
</div>

{% block extrahtml %}
{% end %}

</body>
</html>
