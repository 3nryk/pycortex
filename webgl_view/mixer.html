<!doctype html>
<html lang="en">
    <head>
        <title>three.js webgl - loaders - vtk loader</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                background-color: #888;
                color: #fff;
                margin: 0px;
                overflow: hidden;
            }
        </style>
        <script src="https://raw.github.com/gero3/three.js/morphTargets2/build/Three.js"></script>
        <script src="resources/js/surfload.js"></script>
        <script src='resources/js/jquery-1.7.2.min.js'></script>
        <script src='resources/js/LandscapeControls.js'></script>
        <script type='text/javascript'>
        function init() {
            // scene and camera
            var scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 0.1, 5e4 );
            camera.position.x = 200;
            camera.position.y = 200;
            camera.position.z = 0;
            camera.lookAt(new THREE.Vector3(0,0,0));

            scene.add( camera );

            controls = new THREE.LandscapeControls( camera, $("#threeDview")[0] );

            controls.rotateSpeed = 5.0;
            controls.zoomSpeed = 20;
            controls.panSpeed = 2;

            controls.noZoom = false;
            controls.noPan = false;

            controls.staticMoving = true;
            controls.dynamicDampingFactor = 0.3;

            var dirLight = new THREE.DirectionalLight( 0xffffff );
            dirLight.position.set( 200, 200, 1000 ).normalize();
            camera.add( dirLight );
            camera.add( dirLight.target );

            // renderer
            renderer = new THREE.WebGLRenderer( { antialias: false } );
            renderer.setClearColorHex( 0x000000, 1 );
            renderer.setSize( window.innerWidth,window.innerHeight-50);

            $("#threeDview").append( renderer.domElement );

            material = new THREE.MeshLambertMaterial( { color: 0xFFFFFF, morphTargets: true, morphNormals: true } )
            var loader=new THREE.BinSurfLoader();
            loader.load ("/surfaces/JG/", function(geom){
                geometry = geom;
                mesh = new THREE.Mesh(geom, material);
                mesh.doubleSided=true;
                mesh.rotation.x = -Math.PI/2;
                scene.add( mesh );
                animate();
            });

            function animate() {
                requestAnimationFrame( animate );
                controls.update();
                renderer.render( scene, camera );
            }
        }
        $(document).ready(init)
        function setMix(val) {
            var num = 3-1;
            for (var i=0; i < num; i++)
                mesh.morphTargetInfluences[i] = 0;

            var n1 = Math.floor(val * num)-1;
            var n2 = Math.ceil(val * num)-1;
            mesh.morphTargetInfluences[n2] = (val * num)%1;
            if (n1 >= 0)
                mesh.morphTargetInfluences[n1] = 1 - (val * num)%1;
            
        }
        $(document).ready(function() {
            $("#mix").width(window.innerWidth);
            $("#mix").change(function() {
                setMix(this.value / 10000);
            })
        })
        </script>
    </head>

    <body>
        <div id='threeDview'>
        </div>
        <input id="mix" type="range" min="0" max="10000" value="0">
    </body>
</html>
